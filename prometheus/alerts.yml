groups:
  - name: cosmos_validator_alerts
    interval: 30s
    rules:
      # Node sync alerts
      - alert: ValidatorNodeNotSyncing
        expr: tendermint_consensus_latest_block_height{job="cosmos-node"} == 0
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Validator node is not producing blocks"
          description: "The validator node has not seen any new blocks for 5 minutes. Block height is 0."

      - alert: ValidatorNodeCatchingUp
        expr: tendermint_consensus_fast_syncing{job="cosmos-node"} == 1
        for: 30m
        labels:
          severity: warning
        annotations:
          summary: "Validator node is catching up"
          description: "The validator has been in catch-up mode for 30 minutes."

      - alert: ValidatorBlockHeightStale
        expr: increase(tendermint_consensus_latest_block_height{job="cosmos-node"}[5m]) == 0
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Validator block height not increasing"
          description: "Block height has not increased in the last 5 minutes. Node may be stuck."

      # Validator performance alerts
      - alert: ValidatorMissingBlocks
        expr: increase(tendermint_consensus_validator_missed_blocks{job="cosmos-node"}[1h]) > 5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Validator missing blocks"
          description: "Validator has missed {{ $value }} blocks in the last hour."

      - alert: ValidatorHighMissedBlocks
        expr: increase(tendermint_consensus_validator_missed_blocks{job="cosmos-node"}[1h]) > 20
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Validator missing too many blocks"
          description: "Validator has missed {{ $value }} blocks in the last hour. Risk of slashing!"

      # Peer connectivity alerts
      - alert: LowPeerCount
        expr: tendermint_p2p_peers{job="cosmos-node"} < 3
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Low peer count"
          description: "Node has only {{ $value }} connected peers. Minimum recommended is 3."

      - alert: NoPeers
        expr: tendermint_p2p_peers{job="cosmos-node"} == 0
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "No peers connected"
          description: "Node has no connected peers for 5 minutes."

      # System resource alerts
      - alert: HighCPUUsage
        expr: 100 - (avg by (instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
        for: 15m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage"
          description: "CPU usage is above 80% for 15 minutes: {{ $value }}%"

      - alert: HighMemoryUsage
        expr: (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 > 85
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "High memory usage"
          description: "Memory usage is above 85%: {{ $value }}%"

      - alert: CriticalMemoryUsage
        expr: (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 > 95
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Critical memory usage"
          description: "Memory usage is above 95%: {{ $value }}%"

      - alert: LowDiskSpace
        expr: (node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"}) * 100 < 20
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Low disk space"
          description: "Disk space is below 20%: {{ $value }}% remaining"

      - alert: CriticalDiskSpace
        expr: (node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"}) * 100 < 10
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Critical disk space"
          description: "Disk space is below 10%: {{ $value }}% remaining. Node may stop!"

      # Mempool alerts
      - alert: LargeMempool
        expr: tendermint_mempool_size{job="cosmos-node"} > 1000
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Large mempool size"
          description: "Mempool has {{ $value }} transactions pending for 10 minutes."

      # Consensus alerts
      - alert: ConsensusRoundIncreasing
        expr: rate(tendermint_consensus_rounds[5m]) > 0.5
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Consensus rounds increasing rapidly"
          description: "Consensus is going through multiple rounds. May indicate network issues."

      # New delegations (monitoring for increases in voting power)
      - alert: NewDelegation
        expr: increase(tendermint_consensus_validator_power{job="cosmos-node"}[10m]) > 0
        for: 1m
        labels:
          severity: info
        annotations:
          summary: "New delegation received"
          description: "Validator voting power increased by {{ $value }}. New delegation(s) received!"

      # Validator jailed alert (would need to be manually set)
      - alert: ValidatorJailed
        expr: cosmos_validator_jailed == 1
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Validator is jailed!"
          description: "Validator has been jailed and is not participating in consensus."

  - name: system_health
    interval: 30s
    rules:
      # Container health
      - alert: ContainerDown
        expr: up{job=~"cosmos-node|prometheus|alertmanager"} == 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Container {{ $labels.job }} is down"
          description: "Container {{ $labels.job }} has been down for 2 minutes."

      # High network usage
      - alert: HighNetworkReceive
        expr: rate(node_network_receive_bytes_total[5m]) > 100000000
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "High network receive rate"
          description: "Network receive rate is {{ $value | humanize }}B/s for 10 minutes."

  - name: governance_alerts
    interval: 1h
    rules:
      # Alert when there are active proposals
      - alert: ActiveGovernanceProposal
        expr: tendermint_consensus_height{job="cosmos-node"} > 0
        for: 1h
        labels:
          severity: info
        annotations:
          summary: "Check for active governance proposals"
          description: "Remember to check for active governance proposals and vote."

